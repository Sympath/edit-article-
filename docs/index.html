<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><title>Documents</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="stylesheet" href="./assets/css/bulma.min.css"><link rel="stylesheet" href="./assets/css/app.css"><!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="shortcut icon" href=""></head><body dir="ltr"><nav class="columns navbar"><div class="column logo is-3 is-offset-1"><a class="is-brand" href="./index.html">Documents</a></div></nav><div class="columns content"><div class="column is-2-desktop is-3-widescreen is-hidden-touch"></div><div class="column article-container is-11-tablet is-8-desktop is-6-widescreen"><div class="breadcrumb-area"><a href="./index.html" class="breadcrumb-item">Home</a></div><h1 class="article-title"># 插件实现背景</h1><div class="article"><p>微医工具集，目前实现功能如下</p><h3 id="功能箱目录">功能箱目录 <a class="markdownIt-Anchor" href="#功能箱目录">#</a></h3><p>选中目录工具箱</p><ul><li>右键启动静态服务 doCommandInHere</li><li>tree 输出转自动生成目录 formatProject</li><li>获取目录并生成 tree 结果 getProject</li></ul><p>右键工具箱</p><ul><li>发文格式自动化 formatArticle</li><li>生成保存自动格式化的配置文件 formatOnSave</li><li>下一行插入 log insertLog 【支持 js 和 shell】</li><li>横杠下划线转驼峰 toCamel</li><li>合并 package.json 依赖项 mergePackage</li></ul><p>snippet</p><ul><li>集成 shell 的 snippet：包含语句式 和 函数式</li><li></li></ul><h3 id="插件机制">插件机制 <a class="markdownIt-Anchor" href="#插件机制">#</a></h3><p>为了让其他人方便的参与，暴露的自定义命令的机制，使用的同学可以自行实现自己的需求，然后按如下步骤实现接入 vscode。</p><ol><li>实现自己的需求，并按照 commonjs 规范导出一个函数（会在触发时执行）</li><li>在项目根目录下新建 weiyi-tool-commands，将自己的实现放在此目录下</li><li>使用时唤起命令面板（cmd+shift+p）执行 custom 命令，会弹出选择框，选中自己的命令即可触发定义的逻辑<br>补充：关于 node 相关的 api 可以直接引入使用，vscode 相关的 api 绑定在了函数执行上下文的 this 中，函数执行时 this 代表 VscodeApi 对象（关于此对象提供的能力可见下文）</li></ol><h3 id="待完成功能">待完成功能 <a class="markdownIt-Anchor" href="#待完成功能">#</a></h3><ul><li>提供接入文档</li><li>用户自定义能力优化：目前存在问题如下<ul><li>当用户上传后保存的是 vscode 的空间，这时开发者发版就会删掉用户的上传</li><li>自定义同名情况处理（同时也需要考虑 uploadedCallback 的清空）</li><li>自定义时文档的提供（nodeApi 和 vscodeApi），需实现一个文档网站（可参考 jsdoc）</li><li>snippet 上传校验：当不符合条件时不执行上传动作</li><li>支持用户上传实现的插件方法</li><li>支持选择一个文件或者目录作为初始化内容</li><li>支持指定相关扩展：弹窗显示扩展名+执行【@command:workbench.extensions.action.installExtensions】打开扩展安装区</li></ul></li><li>思考如何支持接入者提 issue：如需要补充 vscodeApi 新的能力，目前可以通过 vscodeApi.vscode 实现，但还是尽可能封装一层</li><li>重构为 ts 项目</li><li>思考如何支持接入者提 issue</li><li>思考怎么让用户上传命令对应的安装方式，从而做到自动优化</li></ul><h2 id="功能详解">功能详解 <a class="markdownIt-Anchor" href="#功能详解">#</a></h2><h3 id="发文格式自动化-formatarticle">发文格式自动化 formatArticle <a class="markdownIt-Anchor" href="#发文格式自动化-formatarticle">#</a></h3><h5 id="面向问题">面向问题 <a class="markdownIt-Anchor" href="#面向问题">#</a></h5><p>微医前端发文存在自己的固定格式，主要包含</p><ul><li><code>([\u4e00-\u9fa5]+)([\da-zA-Z]+)</code>替换为<code>$1 $2</code>：中文和英文要有一个空格</li><li><code>([\da-zA-Z]+)([\u4e00-\u9fa5]+)</code>替换为<code>$1 $2</code>：中文和英文要有一个空格</li><li><code>!\[.+\]</code>替换为<code>![]</code>：处理图片描述<br>这些动作每次需要人为处理，费时费力且易出错，固化流程尝试改用 vscode 插件自动实现，遂有 weiyi-tool 插件出现</li></ul><h5 id="效果">效果 <a class="markdownIt-Anchor" href="#效果">#</a></h5><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h21uyzwezeg21940u078r.gif" alt=""><figcaption>2022-05-08 23.28.59</figcaption></figure><h3 id="生成保存自动格式化的配置文件-formatonsave">生成保存自动格式化的配置文件 formatOnSave <a class="markdownIt-Anchor" href="#生成保存自动格式化的配置文件-formatonsave">#</a></h3><h5 id="面向问题-1">面向问题 <a class="markdownIt-Anchor" href="#面向问题-1">#</a></h5><p>利用 vscode 配置文件 + prettier + eslint 实现保存自动格式化：<a href="https://juejin.cn/post/7103462793500131336/" target="_blank" rel="noopener">https://juejin.cn/post/7103462793500131336/</a></p><h5 id="效果-1">效果 <a class="markdownIt-Anchor" href="#效果-1">#</a></h5><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h30n3norlcj20se09p3yy.jpg" alt=""><figcaption>wecom-temp-4b07b297e13c92ac5d6bf4d2e096e2ff</figcaption></figure><h3 id="在选中目录下执行全局命令-docommandinhere">在选中目录下执行全局命令 doCommandInHere <a class="markdownIt-Anchor" href="#在选中目录下执行全局命令-docommandinhere">#</a></h3><h5 id="面向问题-2">面向问题 <a class="markdownIt-Anchor" href="#面向问题-2">#</a></h5><p>我们使用 live-server 启动一个静态服务，但每次都要经历【开终端 - cd 到指定目录 - 执行 live-server】，终端还不能干掉</p><h5 id="效果-2">效果 <a class="markdownIt-Anchor" href="#效果-2">#</a></h5><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h30n9fbu3zg21et0lftlj.gif" alt=""><figcaption>2022-06-08 10.50.01</figcaption></figure><h3 id="横杠转驼峰-tohump">横杠转驼峰 toHump <a class="markdownIt-Anchor" href="#横杠转驼峰-tohump">#</a></h3><h5 id="面向问题-3">面向问题 <a class="markdownIt-Anchor" href="#面向问题-3">#</a></h5><p>在引入组件时，文件名是横杠格式的，而组件名是驼峰格式的，这个转换的动作十分重复</p><h5 id="效果-3">效果 <a class="markdownIt-Anchor" href="#效果-3">#</a></h5><h5 id="面向问题-4">面向问题 <a class="markdownIt-Anchor" href="#面向问题-4">#</a></h5><p>横杠转驼峰，我们在引入配置文件的时候</p><h5 id="效果-4">效果 <a class="markdownIt-Anchor" href="#效果-4">#</a></h5><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h30n3norlcj20se09p3yy.jpg" alt=""><figcaption>wecom-temp-4b07b297e13c92ac5d6bf4d2e096e2ff</figcaption></figure><h5 id="面向问题-5">面向问题 <a class="markdownIt-Anchor" href="#面向问题-5">#</a></h5><p>实现 tree 输出转自动生成目录，复制 tree 命令输出内容，在需要生成的根目录下右键【formatProject】，会自动生成对应的目录结构；用于项目分享、文章分享时使用</p><h5 id="效果-5">效果 <a class="markdownIt-Anchor" href="#效果-5">#</a></h5><figure><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h3ejhn9cfmg21bg0ligqi.gif" alt=""><figcaption>2022-06-20 11.17.21</figcaption></figure><h2 id="使用执行">使用执行 <a class="markdownIt-Anchor" href="#使用执行">#</a></h2><h3 id="安装插件">安装插件 <a class="markdownIt-Anchor" href="#安装插件">#</a></h3><p>在 vscode 侧边的扩展中搜索【weiyi-tool】安装。</p><h3 id="执行插件">执行插件 <a class="markdownIt-Anchor" href="#执行插件">#</a></h3><p>在命令面板执行对应命令即可。唤起命令面板快捷键如下</p><ul><li>mac：cmd + shift + p</li><li>win：ctrl + shift + p</li></ul><h3 id="使用效果">使用效果 <a class="markdownIt-Anchor" href="#使用效果">#</a></h3><h2 id="未启动的命令">未启动的命令 <a class="markdownIt-Anchor" href="#未启动的命令">#</a></h2><pre class="hljs"><code>// { 插入log日志
        &quot;command&quot;: &quot;weiyi-tool.insertLog&quot;,
        &quot;title&quot;: &quot;insertLog&quot;
      //   &quot;command&quot;: &quot;weiyi-tool.helloWorld&quot;,
      //   &quot;title&quot;: &quot;Hello weiyi-tool&quot;
      // },
      // { 选中的字符反转
      //   &quot;command&quot;: &quot;weiyi-tool.reserve&quot;,
      //   &quot;title&quot;: &quot;Hello reserve&quot;
      // },
      // { 选中的代码块上下插入console.time
      //   &quot;command&quot;: &quot;weiyi-tool.insertTime&quot;,
      //   &quot;title&quot;: &quot;insertTime&quot;
      // },
      // { 删除当前文档中所有的log
      //   &quot;command&quot;: &quot;weiyi-tool.delLog&quot;,
      //   &quot;title&quot;: &quot;delLog&quot;
      // },
</code></pre><h1 id="注释的快捷键">注释的快捷键 <a class="markdownIt-Anchor" href="#注释的快捷键">#</a></h1><pre class="hljs"><code>{
        &quot;key&quot;: &quot;ctrl+h&quot;,
        &quot;command&quot;: &quot;weiyi-tool.helloWorld&quot;
      },
      {
        &quot;key&quot;: &quot;ctrl+shift+r&quot;,
        &quot;command&quot;: &quot;weiyi-tool.reserve&quot;
      },
      {
        &quot;key&quot;: &quot;ctrl+shift+t&quot;,
        &quot;command&quot;: &quot;weiyi-tool.insertTime&quot;
      }
</code></pre><h2 id="todo">TODO <a class="markdownIt-Anchor" href="#todo">#</a></h2><ol><li>git 批量上传：一个目录下有多个相关的 git 仓库，输入一个 message 就可以批量上传 checked（gitUpload）</li><li>git 共用仓库管理（暂定仓库目录为 github-manage）<ol><li>拆分下拉：一个仓库选择对应分支，就下载对应分支的内容；比如 util 中存在 cjs 和 es6，选择后会自动下载对应分支；上传时也会只更新那部分内容</li><li>sh 脚本仓库选择框执行</li></ol></li><li>renamePic：批量重命名</li><li>iframe 嵌入使用各个页面，参考https://github.com/wangshoukai/YuQueForVSCode/blob/main/src/extension.ts</li><li>图片提取文字</li><li>文件同步：更改 指定 仓库后一键同步对应所有的下拉仓库（如 utils；解决新增方法后需要手动同步问题）</li><li>同步 shell 脚本仓库，支持<ol><li>下拉选择框执行对应脚本</li><li>更新仓库</li></ol></li><li>支持 kano 微图上传</li><li>嵌入 iframe：使用测吧</li></ol><h2>Table of Contents</h2><ul class="chapter-area"><li class="chapter-item"><a href="./node-api.html">node-api.md</a></li><li class="chapter-item"><a href="./vscode-api.html">vscode-api.md</a></li></ul></div><div dir="ltr" class="level article-bar is-mobile"><div class="level-item has-text-centered"><a title="previous page" class="previouse-article-link link-disabled"><span class="icon icon-previous-disabled" data-icon="previous-disabled"></span></a></div><div class="level-item has-text-centered"><a title="font size" class="link-item link-item-size"><span class="icon icon-size" data-icon="size"></span></a></div><div class="level-item has-text-centered"><a title="table of content" class="link-item link-item-toc"><span class="icon icon-toc" data-icon="toc"></span></a></div><div class="level-item has-text-centered"><a title="top" href="#"><span class="icon icon-up" data-icon="up"></span> <span class="link-content">⤊ Top</span></a></div><div class="level-item has-text-centered"><a title="next page" class="next-article-link" href="./node-api.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a></div></div></div><div class="column is-2-widescreen is-hidden"></div></div><div class="columns foot"><div class="column is-3 is-offset-9 build-by">Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.6.24</div></div><div class="book-toc notification is-warning is-hidden"><h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close</a></span></h3><ul class="chapter-area"><li class="chapter-item"><a href="./node-api.html">node-api.md</a></li><li class="chapter-item"><a href="./vscode-api.html">vscode-api.md</a></li></ul></div><div class="progress-indicator"></div><!-- SCRIPTS --><script>var LOPPO={current_path:"/",relative_root_path:"./",article_toc:'<ul class="markdownIt-TOC">\n<li>\n<ul>\n<li><a href="#%E5%8A%9F%E8%83%BD%E7%AE%B1%E7%9B%AE%E5%BD%95">功能箱目录</a></li>\n<li><a href="#%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6">插件机制</a></li>\n<li><a href="#%E5%BE%85%E5%AE%8C%E6%88%90%E5%8A%9F%E8%83%BD">待完成功能</a></li>\n</ul>\n</li>\n<li><a href="#%E5%8A%9F%E8%83%BD%E8%AF%A6%E8%A7%A3">功能详解</a>\n<ul>\n<li><a href="#%E5%8F%91%E6%96%87%E6%A0%BC%E5%BC%8F%E8%87%AA%E5%8A%A8%E5%8C%96-formatarticle">发文格式自动化 formatArticle</a></li>\n<li><a href="#%E7%94%9F%E6%88%90%E4%BF%9D%E5%AD%98%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-formatonsave">生成保存自动格式化的配置文件 formatOnSave</a></li>\n<li><a href="#%E5%9C%A8%E9%80%89%E4%B8%AD%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%A7%E8%A1%8C%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4-docommandinhere">在选中目录下执行全局命令 doCommandInHere</a></li>\n<li><a href="#%E6%A8%AA%E6%9D%A0%E8%BD%AC%E9%A9%BC%E5%B3%B0-tohump">横杠转驼峰 toHump</a></li>\n</ul>\n</li>\n<li><a href="#%E4%BD%BF%E7%94%A8%E6%89%A7%E8%A1%8C">使用执行</a>\n<ul>\n<li><a href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6">安装插件</a></li>\n<li><a href="#%E6%89%A7%E8%A1%8C%E6%8F%92%E4%BB%B6">执行插件</a></li>\n<li><a href="#%E4%BD%BF%E7%94%A8%E6%95%88%E6%9E%9C">使用效果</a></li>\n</ul>\n</li>\n<li><a href="#%E6%9C%AA%E5%90%AF%E5%8A%A8%E7%9A%84%E5%91%BD%E4%BB%A4">未启动的命令</a></li>\n<li><a href="#todo">TODO</a></li>\n</ul>\n'}</script><script src="./assets/js/app.js"></script></body></html>